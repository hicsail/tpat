{"ast":null,"code":"/**\n * Extend proto.\n */\nmodule.exports = function (proto) {\n  proto.thumb = function thumb(w, h, name, quality, align, progressive, callback, opts) {\n    var self = this,\n        args = Array.prototype.slice.call(arguments);\n    opts = args.pop();\n\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = '';\n    } else {\n      callback = args.pop();\n    }\n\n    w = args.shift();\n    h = args.shift();\n    name = args.shift();\n    quality = args.shift() || 63;\n    align = args.shift() || 'topleft';\n    var interlace = args.shift() ? 'Line' : 'None';\n    self.size(function (err, size) {\n      if (err) {\n        return callback.apply(self, arguments);\n      }\n\n      w = parseInt(w, 10);\n      h = parseInt(h, 10);\n      var w1, h1;\n      var xoffset = 0;\n      var yoffset = 0;\n\n      if (size.width < size.height) {\n        w1 = w;\n        h1 = Math.floor(size.height * (w / size.width));\n\n        if (h1 < h) {\n          w1 = Math.floor(w1 * ((h - h1) / h + 1));\n          h1 = h;\n        }\n      } else if (size.width > size.height) {\n        h1 = h;\n        w1 = Math.floor(size.width * (h / size.height));\n\n        if (w1 < w) {\n          h1 = Math.floor(h1 * ((w - w1) / w + 1));\n          w1 = w;\n        }\n      } else if (size.width == size.height) {\n        var bigger = w > h ? w : h;\n        w1 = bigger;\n        h1 = bigger;\n      }\n\n      if (align == 'center') {\n        if (w < w1) {\n          xoffset = (w1 - w) / 2;\n        }\n\n        if (h < h1) {\n          yoffset = (h1 - h) / 2;\n        }\n      }\n\n      self.quality(quality).in(\"-size\", w1 + \"x\" + h1).scale(w1, h1, opts).crop(w, h, xoffset, yoffset).interlace(interlace).noProfile().write(name, function () {\n        callback.apply(self, arguments);\n      });\n    });\n    return self;\n  };\n\n  proto.thumbExact = function () {\n    var self = this,\n        args = Array.prototype.slice.call(arguments);\n    args.push('!');\n    self.thumb.apply(self, args);\n  };\n};","map":{"version":3,"names":["module","exports","proto","thumb","w","h","name","quality","align","progressive","callback","opts","self","args","Array","prototype","slice","call","arguments","pop","shift","interlace","size","err","apply","parseInt","w1","h1","xoffset","yoffset","width","height","Math","floor","bigger","in","scale","crop","noProfile","write","thumbExact","push"],"sources":["/Users/so._.may._.see._.macy/Desktop/tpat/node_modules/gm/lib/convenience/thumb.js"],"sourcesContent":["\n/**\n * Extend proto.\n */\n\nmodule.exports = function (proto) {\n\n  proto.thumb = function thumb (w, h, name, quality, align, progressive, callback, opts) {\n    var self = this,\n      args = Array.prototype.slice.call(arguments);\n\n    opts = args.pop();\n\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = '';\n    } else {\n      callback = args.pop();\n    }\n\n    w = args.shift();\n    h = args.shift();\n    name = args.shift();\n    quality = args.shift() || 63;\n    align = args.shift() || 'topleft';\n    var interlace = args.shift() ? 'Line' : 'None';\n\n    self.size(function (err, size) {\n      if (err) {\n        return callback.apply(self, arguments);\n      }\n\n      w = parseInt(w, 10);\n      h = parseInt(h, 10);\n\n      var w1, h1;\n      var xoffset = 0;\n      var yoffset = 0;\n\n      if (size.width < size.height) {\n        w1 = w;\n        h1 = Math.floor(size.height * (w/size.width));\n        if (h1 < h) {\n          w1 = Math.floor(w1 * (((h-h1)/h) + 1));\n          h1 = h;\n        }\n      } else if (size.width > size.height) {\n        h1 = h;\n        w1 = Math.floor(size.width * (h/size.height));\n        if (w1 < w) {\n          h1 = Math.floor(h1 * (((w-w1)/w) + 1));\n          w1 = w;\n        }\n      } else if (size.width == size.height) {\n        var bigger = (w>h?w:h);\n        w1 = bigger;\n        h1 = bigger;\n      }\n\n      if (align == 'center') {\n        if (w < w1) {\n          xoffset = (w1-w)/2;\n        }\n        if (h < h1) {\n          yoffset = (h1-h)/2;\n        }\n      }\n\n      self\n      .quality(quality)\n      .in(\"-size\", w1+\"x\"+h1)\n      .scale(w1, h1, opts)\n      .crop(w, h, xoffset, yoffset)\n      .interlace(interlace)\n      .noProfile()\n      .write(name, function () {\n        callback.apply(self, arguments);\n      });\n    });\n\n    return self;\n  };\n\n  proto.thumbExact = function () {\n    var self = this,\n      args = Array.prototype.slice.call(arguments);\n\n    args.push('!');\n\n    self.thumb.apply(self, args);\n  };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}